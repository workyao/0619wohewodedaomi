<!--pages/checkin/checkin.wxml-->
<view class="page-container sand-texture">
  <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
  <view class="checkin-header">
    <view class="header-card card">
      <view class="card-body">
        <view class="checkin-info">
          <view class="date-info">
            <text class="current-date">{{todayDate}}</text>
            <text class="checkin-status" wx:if="{{todayChecked}}">âœ“ ä»Šæ—¥å·²æ‰“å¡</text>
            <text class="checkin-status pending" wx:else>å¾…æ‰“å¡</text>
          </view>
          <view class="streak-info">
            <text class="streak-number">{{checkinDays}}</text>
            <text class="streak-label">è¿ç»­å¤©æ•°</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ­Œæ›²åˆ†ç±»é€‰æ‹© -->
  <view class="category-section">
    <view class="category-tabs">
      <view 
        class="category-tab {{currentCategory === item.key ? 'active' : ''}}"
        wx:for="{{categories}}" 
        wx:key="key"
        bindtap="switchCategory"
        data-category="{{item.key}}"
      >
        <text class="tab-icon">{{item.icon}}</text>
        <text class="tab-label">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- æ­Œæ›²åˆ—è¡¨ -->
  <view class="songs-section">
    <view class="songs-card card">
      <view class="card-header">
        <text class="card-title">{{currentCategoryName}} ({{currentSongs.length}}é¦–)</text>
        <view class="header-actions">
          <text class="select-all" bindtap="toggleSelectAll">
            {{allSelected ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}
          </text>
        </view>
      </view>
      <view class="card-body">
        <view class="songs-list">
          <view 
            class="song-item {{item.checked ? 'checked' : ''}}"
            wx:for="{{currentSongs}}" 
            wx:key="id"
            bindtap="toggleSong"
            data-song-id="{{item.id}}"
          >
            <view class="song-checkbox">
              <view class="checkbox {{item.checked ? 'checked' : ''}}">
                <text class="check-icon" wx:if="{{item.checked}}">âœ“</text>
              </view>
            </view>
            <view class="song-content">
              <view class="song-main">
                <text class="song-title">{{item.title}}</text>
                <text class="song-album">{{item.album}}</text>
              </view>
              <view class="song-meta">
                <text class="song-year">{{item.year}}</text>
                <text class="song-duration">{{item.duration}}</text>
              </view>
            </view>
            <view class="song-action" bindtap="viewSongDetail" data-song="{{item}}">
              <text class="action-icon">â„¹ï¸</text>
            </view>
          </view>
        </view>
        
        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{currentSongs.length === 0}}">
          <text class="empty-icon">ğŸµ</text>
          <text>æš‚æ— æ­Œæ›²</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å·²é€‰æ­Œæ›²ç»Ÿè®¡ -->
  <view class="selected-summary" wx:if="{{selectedSongs.length > 0}}">
    <view class="summary-card card">
      <view class="card-body">
        <view class="summary-content">
          <text class="summary-text">å·²é€‰æ‹© {{selectedSongs.length}} é¦–æ­Œæ›²</text>
          <view class="selected-tags">
            <text 
              class="song-tag" 
              wx:for="{{selectedSongs}}" 
              wx:key="id"
              bindtap="removeSong"
              data-song-id="{{item.id}}"
            >
              {{item.title}} Ã—
            </text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ‰“å¡å¿ƒæƒ…å’Œå¤‡æ³¨ -->
  <view class="mood-section">
    <view class="mood-card card">
      <view class="card-header">
        <text class="card-title">ä»Šæ—¥å¿ƒæƒ…</text>
      </view>
      <view class="card-body">
        <view class="mood-selector">
          <view 
            class="mood-item {{currentMood === item.value ? 'selected' : ''}}"
            wx:for="{{moods}}" 
            wx:key="value"
            bindtap="selectMood"
            data-mood="{{item.value}}"
          >
            <text class="mood-emoji">{{item.emoji}}</text>
            <text class="mood-label">{{item.label}}</text>
          </view>
        </view>
        
        <view class="note-input">
          <textarea 
            class="note-textarea"
            placeholder="åˆ†äº«ä½ ä»Šå¤©å¬åˆ€éƒéŸ³ä¹çš„æ„Ÿå—..."
            value="{{checkinNote}}"
            bindinput="onNoteInput"
            maxlength="200"
          ></textarea>
          <text class="note-counter">{{checkinNote.length}}/200</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <view class="actions-container">
      <button 
        class="btn btn-outline btn-large"
        bindtap="saveDraft"
        disabled="{{selectedSongs.length === 0}}"
      >
        ä¿å­˜è‰ç¨¿
      </button>
      <button 
        class="btn btn-primary btn-large"
        bindtap="submitCheckin"
        disabled="{{selectedSongs.length === 0 || submitting}}"
      >
        {{submitting ? 'æäº¤ä¸­...' : 'å®Œæˆæ‰“å¡'}}
      </button>
    </view>
  </view>
</view>

<!-- åŠ è½½é®ç½© -->
<view class="loading-mask" wx:if="{{loading}}">
  <view class="loading-content">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
