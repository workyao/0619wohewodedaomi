<!--pages/friends/friends.wxml-->
<view class="page-container">
  <!-- é¡¶éƒ¨ç»Ÿè®¡ -->
  <view class="stats-section">
    <view class="stats-card card">
      <view class="card-body">
        <view class="stats-grid">
          <view class="stat-item" bindtap="showFollowing">
            <text class="stat-number">{{followingCount}}</text>
            <text class="stat-label">å…³æ³¨</text>
          </view>
          <view class="stat-item" bindtap="showFollowers">
            <text class="stat-number">{{followersCount}}</text>
            <text class="stat-label">ç²‰ä¸</text>
          </view>
          <view class="stat-item" bindtap="showMutualFriends">
            <text class="stat-number">{{mutualFriendsCount}}</text>
            <text class="stat-label">äº’å…³å¥½å‹</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-bar">
      <input 
        class="search-input" 
        placeholder="æœç´¢ç¨»ç±³æœ‹å‹..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <button class="search-btn" bindtap="onSearch">ğŸ”</button>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µ -->
  <view class="tabs-section">
    <view class="tabs">
      <view 
        class="tab-item {{currentTab === item.key ? 'active' : ''}}"
        wx:for="{{tabs}}" 
        wx:key="key"
        bindtap="switchTab"
        data-tab="{{item.key}}"
      >
        <text class="tab-text">{{item.name}}</text>
        <text class="tab-count" wx:if="{{item.count > 0}}">({{item.count}})</text>
      </view>
    </view>
  </view>

  <!-- æœ‹å‹åˆ—è¡¨ -->
  <view class="friends-section">
    <view class="friends-list">
      <view 
        class="friend-card card"
        wx:for="{{currentFriends}}" 
        wx:key="openid"
        wx:for-item="friend"
      >
        <view class="card-body">
          <view class="friend-info">
            <image class="avatar avatar-medium" src="{{friend.avatarUrl}}" mode="aspectFill"></image>
            <view class="friend-details">
              <text class="friend-name">{{friend.nickName}}</text>
              <text class="friend-desc">{{friend.desc || 'è¿™ä¸ªç¨»ç±³å¾ˆç¥ç§˜...'}}</text>
              <view class="friend-stats">
                <text class="stat-text">è¿ç»­æ‰“å¡ {{friend.checkinDays}} å¤©</text>
                <text class="stat-text">Lv.{{friend.level || 1}}</text>
              </view>
            </view>
          </view>
          
          <view class="friend-actions">
            <!-- å…³æ³¨çŠ¶æ€ -->
            <button 
              class="action-btn follow-btn {{friend.isFollowing ? 'following' : ''}}"
              bindtap="toggleFollow"
              data-friend="{{friend}}"
              wx:if="{{currentTab !== 'search' || friend.openid !== userOpenid}}"
            >
              <text class="btn-text">{{friend.isFollowing ? 'å·²å…³æ³¨' : 'å…³æ³¨'}}</text>
            </button>
            
            <!-- ç§èŠæŒ‰é’® -->
            <button 
              class="action-btn chat-btn"
              bindtap="startChat"
              data-friend="{{friend}}"
              wx:if="{{friend.isFollowing || friend.isFollower}}"
            >
              <text class="btn-icon">ğŸ’¬</text>
            </button>
            
            <!-- æ›´å¤šæ“ä½œ -->
            <button 
              class="action-btn more-btn"
              bindtap="showMoreActions"
              data-friend="{{friend}}"
            >
              <text class="btn-icon">â‹¯</text>
            </button>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore}}">
      <button class="btn btn-outline" bindtap="loadMore" disabled="{{loading}}">
        {{loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}
      </button>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{currentFriends.length === 0 && !loading}}">
      <text class="empty-icon">{{emptyStateIcon}}</text>
      <text class="empty-text">{{emptyStateText}}</text>
      <text class="empty-desc">{{emptyStateDesc}}</text>
      <button class="btn btn-primary" bindtap="goToSquare" wx:if="{{currentTab === 'following'}}">
        å»å¹¿åœºçœ‹çœ‹
      </button>
    </view>
  </view>

  <!-- æ¨èæœ‹å‹ -->
  <view class="recommend-section" wx:if="{{currentTab === 'following' && recommendFriends.length > 0}}">
    <view class="recommend-card card">
      <view class="card-header">
        <text class="card-title">ğŸŒŸ æ¨èå…³æ³¨</text>
      </view>
      <view class="card-body">
        <scroll-view class="recommend-scroll" scroll-x="true">
          <view class="recommend-list">
            <view 
              class="recommend-item"
              wx:for="{{recommendFriends}}" 
              wx:key="openid"
              wx:for-item="user"
              bindtap="followRecommendUser"
              data-user="{{user}}"
            >
              <image class="recommend-avatar" src="{{user.avatarUrl}}" mode="aspectFill"></image>
              <text class="recommend-name">{{user.nickName}}</text>
              <text class="recommend-reason">{{user.reason}}</text>
            </view>
          </view>
        </scroll-view>
      </view>
    </view>
  </view>
</view>

<!-- åŠ è½½é®ç½© -->
<view class="loading-mask" wx:if="{{loading && currentFriends.length === 0}}">
  <view class="loading-content">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
