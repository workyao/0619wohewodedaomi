<!--pages/song-detail/song-detail.wxml-->
<view class="page-container desert-pattern">
  <!-- æ­Œæ›²ä¿¡æ¯å¡ç‰‡ -->
  <view class="song-info-card card">
    <view class="card-body">
      <view class="song-header">
        <view class="song-main-info">
          <text class="song-title">{{song.title}}</text>
          <text class="song-album">ä¸“è¾‘ï¼š{{song.album}}</text>
          <view class="song-meta">
            <text class="song-year">{{song.year}}å¹´</text>
            <text class="song-duration">{{song.duration}}</text>
          </view>
        </view>
        <view class="song-actions">
          <button class="action-btn favorite {{isFavorite ? 'active' : ''}}" bindtap="toggleFavorite">
            <text class="action-icon">{{isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
            <text class="action-text">æ”¶è—</text>
          </button>
        </view>
      </view>
      
      <!-- æ­Œæ›²ç»Ÿè®¡ -->
      <view class="song-stats">
        <view class="stat-item">
          <text class="stat-number">{{listenCount}}</text>
          <text class="stat-label">æ”¶å¬æ¬¡æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{checkinCount}}</text>
          <text class="stat-label">æ‰“å¡æ¬¡æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{favoriteCount}}</text>
          <text class="stat-label">æ”¶è—äººæ•°</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ­Œè¯å±•ç¤º -->
  <view class="lyrics-section">
    <view class="lyrics-card card">
      <view class="card-header">
        <text class="card-title">ğŸµ æ­Œè¯</text>
        <view class="lyrics-controls">
          <button class="control-btn {{showPinyin ? 'active' : ''}}" bindtap="togglePinyin">
            <text class="control-text">æ‹¼éŸ³</text>
          </button>
          <button class="control-btn" bindtap="copyLyrics">
            <text class="control-text">å¤åˆ¶</text>
          </button>
        </view>
      </view>
      <view class="card-body">
        <view class="lyrics-content">
          <view 
            class="lyrics-line"
            wx:for="{{lyricsLines}}" 
            wx:key="index"
          >
            <text class="lyrics-text">{{item.text}}</text>
            <text class="lyrics-pinyin" wx:if="{{showPinyin && item.pinyin}}">{{item.pinyin}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç®€è°±å±•ç¤º -->
  <view class="score-section" wx:if="{{song.score}}">
    <view class="score-card card">
      <view class="card-header">
        <text class="card-title">ğŸ¼ ç®€è°±</text>
        <button class="control-btn" bindtap="viewFullScore">
          <text class="control-text">æŸ¥çœ‹å¤§å›¾</text>
        </button>
      </view>
      <view class="card-body">
        <view class="score-preview">
          <image class="score-image" src="{{song.score}}" mode="widthFix" bindtap="viewFullScore"></image>
        </view>
      </view>
    </view>
  </view>

  <!-- ç›¸å…³æ¨è -->
  <view class="related-section">
    <view class="related-card card">
      <view class="card-header">
        <text class="card-title">ğŸ¶ ç›¸å…³æ¨è</text>
      </view>
      <view class="card-body">
        <view class="related-songs">
          <view 
            class="related-song-item"
            wx:for="{{relatedSongs}}" 
            wx:key="id"
            bindtap="goToSong"
            data-song-id="{{item.id}}"
          >
            <view class="song-info">
              <text class="song-name">{{item.title}}</text>
              <text class="song-album-name">{{item.album}}</text>
            </view>
            <view class="song-duration">{{item.duration}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ‰“å¡è®°å½• -->
  <view class="checkin-records-section">
    <view class="records-card card">
      <view class="card-header">
        <text class="card-title">ğŸ“ æˆ‘çš„æ‰“å¡è®°å½•</text>
        <text class="record-count">å…±{{checkinRecords.length}}æ¬¡</text>
      </view>
      <view class="card-body">
        <view class="records-list">
          <view 
            class="record-item"
            wx:for="{{checkinRecords}}" 
            wx:key="id"
          >
            <view class="record-date">{{item.dateStr}}</view>
            <view class="record-mood" wx:if="{{item.mood}}">
              <text class="mood-emoji">{{item.moodEmoji}}</text>
              <text class="mood-text">{{item.moodText}}</text>
            </view>
            <view class="record-note" wx:if="{{item.note}}">{{item.note}}</view>
          </view>
        </view>
        
        <view class="empty-state" wx:if="{{checkinRecords.length === 0}}">
          <text class="empty-icon">ğŸ“</text>
          <text>è¿˜æ²¡æœ‰æ‰“å¡è®°å½•</text>
          <button class="btn btn-primary btn-small" bindtap="goToCheckin">
            å»æ‰“å¡
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <view class="actions-container">
      <button class="btn btn-outline" bindtap="shareToFriends">
        <text class="btn-icon">ğŸ”„</text>
        <text class="btn-text">åˆ†äº«</text>
      </button>
      <button class="btn btn-primary" bindtap="addToCheckin">
        <text class="btn-icon">ğŸ“</text>
        <text class="btn-text">åŠ å…¥æ‰“å¡</text>
      </button>
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-mask" wx:if="{{loading}}">
  <view class="loading-content">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
